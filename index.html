<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>kirago杂谈</title><meta name="author" content="kirago"><meta name="copyright" content="kirago"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="勿以浮沙筑高台">
<meta property="og:type" content="website">
<meta property="og:title" content="kirago杂谈">
<meta property="og:url" content="http://kiragoo.github.com/index.html">
<meta property="og:site_name" content="kirago杂谈">
<meta property="og:description" content="勿以浮沙筑高台">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://tva1.sinaimg.cn/large/7a56748fly1gpf04wkr1wj20qs13wabo.jpg">
<meta property="article:author" content="kirago">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://tva1.sinaimg.cn/large/7a56748fly1gpf04wkr1wj20qs13wabo.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://kiragoo.github.com/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="U43Wg28cXgqBF3zsdKJjCM_HS7mLpBZCbTr_l28-SVU"/><meta name="msvalidate.01" content="D46A8B7283B082BEE5F98315AD0AF253"/><meta name="baidu-site-verification" content="code-Xd19SnTCHD"/><link rel="stylesheet" href="/null"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-04-21 20:57:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="kirago杂谈" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="http://tva1.sinaimg.cn/large/7a56748fly1gpf04wkr1wj20qs13wabo.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">32</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">kirago杂谈</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">kirago杂谈</h1><div id="site_social_icons"><a class="social-icon" href="https://github.com/kiragoo" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:zhangl910201@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/archives/7c305169.html" title="利用 nektos/act debug github action locally">     <img class="post_bg" src="https://github.com/kiragoo/kimg/raw/master/blogimgs/act-devops.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="利用 nektos/act debug github action locally"></a></div><div class="recent-post-info"><a class="article-title" href="/archives/7c305169.html" title="利用 nektos/act debug github action locally">利用 nektos/act debug github action locally</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-04-06T14:35:37.000Z" title="发表于 2022-04-06 22:35:37">2022-04-06</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/devops/">devops</a></span></div><div class="content">我们都知道利用 Github Action 可以用来进行构建CI的流水线，通过构建对应的jobs来实现我们的期望效果，对于目前来说很多时候构建之后的效果目前只能在远端repo才能够看到最终的执行结果，那么我们是否有机会能够在本地构建，然后来类似DEBUG看到最后期望呢？这里我将介绍如何利用nektos/act这一利器来本地执行 Github Action。
概览根据官方仓库的概览描述告诉了我们对于本地构建的急切缘由！

及时的结果反馈。 通过本地构建我们无需通过 commit/push 的事件来触发远端repo的action。我们完全可以在本地进行模拟Github Actions所达到的效果，从而得到一个及时的结果信息反馈。
我们完全可以通过流式线形式的构建来替换 Makefile 文件

实际操作这里假设你已经具备基本的Github Action配置能力，且具备初步的使用能力，此篇章主要是对 act 的配置及使用。安装完可以通过 act -h 进行简单的查看验证。
安装本人使用的是 macos，可以通过 brew install act 进行安装，其他 os 发行版可以参考官方仓库中 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/archives/ba22a6bc.html" title="手撕client-go:如何编写CRD client">     <img class="post_bg" src="http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="手撕client-go:如何编写CRD client"></a></div><div class="recent-post-info"><a class="article-title" href="/archives/ba22a6bc.html" title="手撕client-go:如何编写CRD client">手撕client-go:如何编写CRD client</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-12-24T12:46:08.000Z" title="发表于 2021-12-24 20:46:08">2021-12-24</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/kubernetes/CRD/">CRD</a></span></div><div class="content">需求背景分析基于 k8s 的二次开发过程中，有些场景我们会定制化的去开发自己的 CRD + Controller，即 Operator来实现基于k8s的云原生化的部署与自动化运维功能，暂且称之为底层的基座能力。
如果我们想基于底层能力，并想要将其封装为控制台来供上层业务调用的话，我们需要有机会能够去控制与使用这样的接口能力，基于对Client-go的使用，也许有胖友会想到dynamic client的使用，但是作为设计与开发人员，我们应该清醒的认识到对于序列化与反序列化过程，扔一堆map是多么的头疼（除非恰巧业务开发人员与Operator设计设计者是同一人&gt;..&lt;）。
我们能不能有机会像使用k8s 中的原生资源如Deployments、Service等一样方便的去使用呢？
必备概念与技能在进行具体分析前，建议胖友先去了解下Kubernetes API 概念，同时具备查阅Kubernetes API的能力。
为了方便举例，我在本地k8s集群注册了emqx-operator 中的 CRD自定义资源，将其视为与 k8s 原生资源同等地位。
12emqxbrokers.apps.e ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/archives/3562ba1.html" title="手撕kube-proxy iptables实例">     <img class="post_bg" src="http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="手撕kube-proxy iptables实例"></a></div><div class="recent-post-info"><a class="article-title" href="/archives/3562ba1.html" title="手撕kube-proxy iptables实例">手撕kube-proxy iptables实例</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-11-04T03:58:55.000Z" title="发表于 2021-11-04 11:58:55">2021-11-04</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/kubernetes/%E7%BD%91%E7%BB%9C/">网络</a></span></div><div class="content">继 iptables 入门出坑之后，加深个人理解无非是实战，此篇我们来通过示例来加深个人理解。
环境准备本人是 mbp，由于 Docker Desktop For Mac 实在太黑盒了，打算用 minikube 来进行 k8s 实验环境的部署。
对于需要的 minikube, kubectl 这种基本依赖可执行文件具体就不写步骤了。最终执行如下命令拉起 k8s 集群：
1234567891011121314151617181920212223242526272829minikube start --image-mirror-country=&#x27;cn&#x27; --image-repository=&#x27;registry.cn-hangzhou.aliyuncs.com/google_containers&#x27;  --kubernetes-version=v1.21.0😄  Darwin 11.6 上的 minikube v1.21.0❗  Kubernetes 1.21.0 has a known performance issue on cluster sta ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/archives/26a027f0.html" title="iptables 入门出坑">     <img class="post_bg" src="http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="iptables 入门出坑"></a></div><div class="recent-post-info"><a class="article-title" href="/archives/26a027f0.html" title="iptables 入门出坑">iptables 入门出坑</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-11-02T02:42:35.000Z" title="发表于 2021-11-02 10:42:35">2021-11-02</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Linux/">Linux</a></span></div><div class="content">
本文整理自iptables长文详解，值得收藏细读整理此篇博文的初衷还是因为目前很多 k8s 的内部的 service 路由规则还是通过 iptables 来实现的，否则最终还是只停留在使用层面，能够让我们对某个服务夯住又多了个排查利器。

Linux 的网络控制模块在内核中，叫做netfilter。而iptables是位于用户空间的一个命令行工具，它作用在OIS7层网络模型中的第四层[物理层，数据链路层，网络层，传输层，会话层，表示层，应用层]，用来和内核的netfilter交互，配置netfilter进而实现对网络的控制、流量的转发。
主要功能：

流量转发：DNAT 实现 IP 地址和端口的映射
负载均衡：statistic 模块为每个后端设置权重
会话保持：recent 模块设置会话保持时间

基本两要素表和链路，5表5链路。
5张表分别是：raw,filter,nat,mangle,security5条链路分别是：prerouting,input,forward,output,postrouting
通过 iptables -t $&#123;table&#125; -nL  ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/archives/f7f100a2.html" title="kubernetes源码分析系列之源码分析系列之Statefulset Controller">     <img class="post_bg" src="http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kubernetes源码分析系列之源码分析系列之Statefulset Controller"></a></div><div class="recent-post-info"><a class="article-title" href="/archives/f7f100a2.html" title="kubernetes源码分析系列之源码分析系列之Statefulset Controller">kubernetes源码分析系列之源码分析系列之Statefulset Controller</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-10-21T03:01:43.000Z" title="发表于 2021-10-21 11:01:43">2021-10-21</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/kubernetes/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a></span></div><div class="content">
对于分析 Controller 源码选用 StatefulSet Controller 来，其它控制器源码分析一个套路，可以做参考。

StatefulSet 简介此篇文章默认你已经具备了熟练使用 Statefulset 的基础知识，所以常规介绍及使用 Demo 的描述不在阐述，具体可参考 StatefulSet 基础
StatefulSet Controller 启动分析kube-manager-controller 入口调用链分析对于 Kubernetes 的源码组织结构不做过多介绍，希望你有一定的了解。
对于 k8s 是如何启动 kube-controller-manager，可以通过文档kube-controller-manager  查找到对应如下内容：
1234--controllers strings     默认值：[*]要启用的控制器列表。\* 表示启用所有默认启用的控制器； foo 启用名为 foo 的控制器； -foo 表示禁用名为 foo 的控制器。控制器的全集：attachdetach、bootstrapsigner、cloud-node-lifecycle ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/archives/a66802dc.html" title="Kubernetes之编写Controller">     <img class="post_bg" src="http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kubernetes之编写Controller"></a></div><div class="recent-post-info"><a class="article-title" href="/archives/a66802dc.html" title="Kubernetes之编写Controller">Kubernetes之编写Controller</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-10-14T03:50:53.000Z" title="发表于 2021-10-14 11:50:53">2021-10-14</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Kubernetes/">Kubernetes</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Kubernetes/Controller/">Controller</a></span></div><div class="content">
翻译自Writing Controllers

Writing ControllerKubernetes Controller 是个“常驻调谐进程”。它除了会“监视”对象的期望状态外，也会“监视”对象的运行状态。会通过发送“指令”尝试着将对象的运行状态更加趋近于期望状态。
如下是个简单的 loop 循环:
12345for &#123;  desired := getDesiredState()  current := getCurrentState()  makeChanges(desired, current)&#125;

Guidelines当我们写 Controller 的时候，有如下知道方针来帮助我们实现我们想要的结果和表现。

一次之操作一个元素。 如果你使用 workqueue.Interface，你将能够将一个具体的Resource入队，然后稍后将它们 pop 到 worker gofuncs，此处需要保证的是同一时间不能有多个 gofuncs 处理同一个元素。

Controllers 会引发多个 Resource 之前的关联关系（例如 Y 发生改变了 我需要检查 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/archives/96e8d00f.html" title="PersistentVolumnes 单Pod 访问模式">     <img class="post_bg" src="http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PersistentVolumnes 单Pod 访问模式"></a></div><div class="recent-post-info"><a class="article-title" href="/archives/96e8d00f.html" title="PersistentVolumnes 单Pod 访问模式">PersistentVolumnes 单Pod 访问模式</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-09-28T03:08:05.000Z" title="发表于 2021-09-28 11:08:05">2021-09-28</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Kubernetes/">Kubernetes</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Kubernetes/PersistentVolumes/">PersistentVolumes</a></span></div><div class="content">
翻译自Introducing Single Pod Access Mode for PersistentVolumes

访问模式及重要意义当使用持久化储存时，对于存储有多种模式进行访问使用。
例如，存储系统中的网络文件可以同时被多个用户进行读写数据。在另一种场景下，也许每个用户允许进行读而不具备写的权限。对于高敏数据，可能只允许一个用户用户进行读写操作而不是所有的用户。
在 Kubernetes 的世界中，access mode就是我们定义持久化存储如何使用的方式。这些访问方式作为 PVs 和 PVCs 中 spec 描述的一部分内容。
12345678910kind: PersistentVolumeClaimapiVersion: v1metadata:  name: shared-cachespec:  accessModes:  - ReadWriteMany # Allow many pods to access shared-cache simultaneously.  resources:    requests:      storage: 1Gi

在 v1.22 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/archives/1d9c7e0d.html" title="深入理解k8s网络原理之-Service原理">     <img class="post_bg" src="http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入理解k8s网络原理之-Service原理"></a></div><div class="recent-post-info"><a class="article-title" href="/archives/1d9c7e0d.html" title="深入理解k8s网络原理之-Service原理">深入理解k8s网络原理之-Service原理</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-09-13T02:05:16.000Z" title="发表于 2021-09-13 10:05:16">2021-09-13</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/kubernetes/network/">network</a></span></div><div class="content">
收集整理，转载自深入理解kubernetes（k8s）网络原理之二-service原理

在深入理解k8s网路原理之-POD连接主机中主要介绍了POD与主机及POD访问外网的原理。
Linux网络基础知识netfilternetfileter子系统5个关键扩展点：

PREROUTING，数据包刚到达时会经过这个点，通常用来完成DNAT的功能。
INPUT，数据包要进入本机的传输层时会经过这个点，通常用来完成防火墙入站检测。
FORWARD，数据包要通过本机转发时会经过这个点，通常用来完成防火墙转发过滤。
OUTPUT，从本机的数据包要出去的时候会经过这个点，通常用来做DNAT和防火墙出站检测。
POSTROUTING，数据包离开本机前会经过这个点，通常用来做SNAT。

1、 主机的应用程序接收外部的数据包会经过的点: PREROUTING -&gt; INPUT
2、 主机的应用程序发送数据包到外部经过的点: OUTPUT -&gt; POSTROUTING
3、 主机的POD发送的数据包去外部或者去主机的另外一个POD: PREROUTING -&gt; FORWARD -&g ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/archives/1d9a37c9.html" title="深入理解k8s网路原理之-POD连接主机">     <img class="post_bg" src="http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入理解k8s网路原理之-POD连接主机"></a></div><div class="recent-post-info"><a class="article-title" href="/archives/1d9a37c9.html" title="深入理解k8s网路原理之-POD连接主机">深入理解k8s网路原理之-POD连接主机</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-09-03T07:58:47.000Z" title="发表于 2021-09-03 15:58:47">2021-09-03</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/kubernetes/network/">network</a></span></div><div class="content">
转载自深入理解kubernetes（k8s）网络原理之一-pod连接主机

关于Linux网络的知识向外发送一个数据包，执行步骤：1、查找该数据包的目的地的路由信息，如果是直连，则在邻居表中查找该目的地的Mac地址2、如果非直连路由，则在邻居表中查找下一跳的Mac地址3、如果找不到对应的路由，则报&quot;network is unreachable&quot;4、如果在邻居表中没有查到相应的MAC地址信息，则向外发送ARP请求询问5、发送出去的数据帧，源MAC地址为发送网卡的MAC地址，目标MAC则是下一跳的MAC，只要不经过NAT，那么源目的IP全程不会变化，而MAC地址则每一跳都会变化
收到数据帧，执行步骤1、如果数据帧目标MAC地址不是收包网卡的MAC，也不是ARP广播地址，且网卡未开启混杂模式，则拒绝收包2、如果数据帧目标MAC为ff:ff:ff:ff:ff:ff，则进入ARP请求处理流程3、如果数据帧目标MAC地址是收包网卡的MAC，且是IP包则：    1、目标IP地址在本机，则上送到上一层协议继续处理    2、目标IP地址不在本机，则看net.ipv4.ip_fo ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/archives/4a17b156.html" title="Hello World">     <img class="post_bg" src="http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"></a></div><div class="recent-post-info"><a class="article-title" href="/archives/4a17b156.html" title="Hello World">Hello World</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-10T02:06:07.672Z" title="发表于 2021-07-10 10:06:07">2021-07-10</time></span></div><div class="content">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.
Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;

More info: Writing
Run server1$ hexo server

More info: Server
Generate static files1$ hexo generate

More info: Generating
Deploy to remote sites1$ hexo deploy

More info: Deployment
</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/#content-inner">4</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="http://tva1.sinaimg.cn/large/7a56748fly1gpf04wkr1wj20qs13wabo.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">kirago</div><div class="author-info__description">勿以浮沙筑高台</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">32</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/kiragoo" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:zhangl910201@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/archives/7c305169.html" title="利用 nektos/act debug github action locally"><img src="https://github.com/kiragoo/kimg/raw/master/blogimgs/act-devops.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="利用 nektos/act debug github action locally"/></a><div class="content"><a class="title" href="/archives/7c305169.html" title="利用 nektos/act debug github action locally">利用 nektos/act debug github action locally</a><time datetime="2022-04-06T14:35:37.000Z" title="发表于 2022-04-06 22:35:37">2022-04-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/ba22a6bc.html" title="手撕client-go:如何编写CRD client"><img src="http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="手撕client-go:如何编写CRD client"/></a><div class="content"><a class="title" href="/archives/ba22a6bc.html" title="手撕client-go:如何编写CRD client">手撕client-go:如何编写CRD client</a><time datetime="2021-12-24T12:46:08.000Z" title="发表于 2021-12-24 20:46:08">2021-12-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/3562ba1.html" title="手撕kube-proxy iptables实例"><img src="http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="手撕kube-proxy iptables实例"/></a><div class="content"><a class="title" href="/archives/3562ba1.html" title="手撕kube-proxy iptables实例">手撕kube-proxy iptables实例</a><time datetime="2021-11-04T03:58:55.000Z" title="发表于 2021-11-04 11:58:55">2021-11-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/26a027f0.html" title="iptables 入门出坑"><img src="http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="iptables 入门出坑"/></a><div class="content"><a class="title" href="/archives/26a027f0.html" title="iptables 入门出坑">iptables 入门出坑</a><time datetime="2021-11-02T02:42:35.000Z" title="发表于 2021-11-02 10:42:35">2021-11-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/f7f100a2.html" title="kubernetes源码分析系列之源码分析系列之Statefulset Controller"><img src="http://tva4.sinaimg.cn/wap800/7a56748fgy1gpf0fb6s0ej22l51xu4d3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kubernetes源码分析系列之源码分析系列之Statefulset Controller"/></a><div class="content"><a class="title" href="/archives/f7f100a2.html" title="kubernetes源码分析系列之源码分析系列之Statefulset Controller">kubernetes源码分析系列之源码分析系列之Statefulset Controller</a><time datetime="2021-10-21T03:01:43.000Z" title="发表于 2021-10-21 11:01:43">2021-10-21</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Kubernetes/"><span class="card-category-list-name">Kubernetes</span><span class="card-category-list-count">2</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Kubernetes/Controller/"><span class="card-category-list-name">Controller</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Kubernetes/PersistentVolumes/"><span class="card-category-list-name">PersistentVolumes</span><span class="card-category-list-count">1</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Linux/"><span class="card-category-list-name">Linux</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/devops/"><span class="card-category-list-name">devops</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/golang/"><span class="card-category-list-name">golang</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/k8s/"><span class="card-category-list-name">k8s</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/kubernetes/"><span class="card-category-list-name">kubernetes</span><span class="card-category-list-count">16</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Controller/" style="font-size: 1.17em; color: #999c9f">Controller</a> <a href="/tags/Gang-scheduling/" style="font-size: 1.1em; color: #999">Gang scheduling</a> <a href="/tags/Kubernetes/" style="font-size: 1.17em; color: #999c9f">Kubernetes</a> <a href="/tags/PersistentVolumes/" style="font-size: 1.1em; color: #999">PersistentVolumes</a> <a href="/tags/StatefulSet/" style="font-size: 1.1em; color: #999">StatefulSet</a> <a href="/tags/act/" style="font-size: 1.1em; color: #999">act</a> <a href="/tags/client-go/" style="font-size: 1.17em; color: #999c9f">client-go</a> <a href="/tags/git/" style="font-size: 1.17em; color: #999c9f">git</a> <a href="/tags/github-action/" style="font-size: 1.1em; color: #999">github action</a> <a href="/tags/golang/" style="font-size: 1.17em; color: #999c9f">golang</a> <a href="/tags/iptables/" style="font-size: 1.23em; color: #999ea6">iptables</a> <a href="/tags/istio/" style="font-size: 1.17em; color: #999c9f">istio</a> <a href="/tags/java/" style="font-size: 1.43em; color: #99a6b9">java</a> <a href="/tags/k8s/" style="font-size: 1.1em; color: #999">k8s</a> <a href="/tags/kube-proxy/" style="font-size: 1.1em; color: #999">kube-proxy</a> <a href="/tags/kube-scheduler/" style="font-size: 1.23em; color: #999ea6">kube-scheduler</a> <a href="/tags/kubeadm/" style="font-size: 1.1em; color: #999">kubeadm</a> <a href="/tags/kubernetes/" style="font-size: 1.5em; color: #99a9bf">kubernetes</a> <a href="/tags/kubernetes-istio/" style="font-size: 1.1em; color: #999">kubernetes - istio</a> <a href="/tags/kubernetes-istio-%E6%96%87%E6%A1%A3/" style="font-size: 1.1em; color: #999">kubernetes - istio - 文档</a> <a href="/tags/leetcode/" style="font-size: 1.17em; color: #999c9f">leetcode</a> <a href="/tags/network/" style="font-size: 1.17em; color: #999c9f">network</a> <a href="/tags/notebook/" style="font-size: 1.1em; color: #999">notebook</a> <a href="/tags/scheduler/" style="font-size: 1.1em; color: #999">scheduler</a> <a href="/tags/service/" style="font-size: 1.1em; color: #999">service</a> <a href="/tags/spring-cloud/" style="font-size: 1.37em; color: #99a4b2">spring cloud</a> <a href="/tags/%E4%BC%98%E5%85%88%E7%BA%A7%E4%B8%8E%E6%8A%A2%E5%8D%A0/" style="font-size: 1.1em; color: #999">优先级与抢占</a> <a href="/tags/%E6%96%87%E6%A1%A3/" style="font-size: 1.1em; color: #999">文档</a> <a href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" style="font-size: 1.3em; color: #99a1ac">源码分析</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.17em; color: #999c9f">算法</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.1em; color: #999">网络</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" style="font-size: 1.1em; color: #999">翻译</a> <a href="/tags/%E8%AE%BE%E8%AE%A1/" style="font-size: 1.1em; color: #999">设计</a> <a href="/tags/%E8%B0%83%E5%BA%A6/" style="font-size: 1.1em; color: #999">调度</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/04/"><span class="card-archive-list-date">四月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/12/"><span class="card-archive-list-date">十二月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/11/"><span class="card-archive-list-date">十一月 2021</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/10/"><span class="card-archive-list-date">十月 2021</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/09/"><span class="card-archive-list-date">九月 2021</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/07/"><span class="card-archive-list-date">七月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/05/"><span class="card-archive-list-date">五月 2021</span><span class="card-archive-list-count">10</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/04/"><span class="card-archive-list-date">四月 2021</span><span class="card-archive-list-count">12</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">32</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-04-21T12:57:52.605Z"></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By kirago</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/null"></script><script src="/null"></script><div class="js-pjax"></div><script async data-pjax src="/null"></script></div></body></html>